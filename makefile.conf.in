# The directory containing the RTcmix directory
TOPDIR = /usr/local/src

# The name of the RTcmix directory
CMIXDIR = $(TOPDIR)/RTcmix-2.3.0

# The dir that will contain links to the instrument dynamic shared objects
LIBDESTDIR = $(CMIXDIR)/shlib

# add new instruments to this list (e.g., insts.std, insts.jg)
INST_DIRS = insts.base insts.std insts.jg

# add new packages to this list (e.g., interfaces.std)
PACKAGE_DIRS =

# Set this to TRUE to use sndlib for file i/o; otherwise use the old cmix i/o.
USE_SNDLIB = TRUE
#USE_SNDLIB = FALSE

# Which platform?
ARCH = LINUX
#ARCH = SGI

# Sound driver API for Linux (and other than SGI)
SOUND_DRIVER = -DOSS
#SOUND_DRIVER = -DALSA

# Uncomment if your sound driver uses multiple mono devices.
#SOUND_DRIVER += -DMONO_DEVICES

# optimization and debugging flags
OPT = -g #-O3
# -Wall -Wno-unused

# Uncomment to use old function table assignments for certain instruments.
# For example, WAVETABLE used to expect function 1 to contain the wavetable
# and function 2 to contain the amp envelope. We swapped these so that you
# can use setline to give the amp envelope. But if you prefer compatibility
# with your existing scores, uncomment this line:
#CMIX_FLAGS = -DCOMPATIBLE_FUNC_LOCS


###############################################################
# Shouldn't need to edit below this line
###############################################################

LIBDIR = $(CMIXDIR)/lib
DESTDIR = $(CMIXDIR)/bin
BINDIR = $(DESTDIR)

# Compile and link time flags

ifeq ($(ARCH),LINUX)
  ARCHFLAGS = -D_REENTRANT -DLINUX $(SOUND_DRIVER)
  CC = gcc 
  CXX = g++ 
  LD = ld
  MAKE = make
  INSTALL = cp -f
  SHELL = /bin/sh
endif
ifeq ($(ARCH),SGI)
  ARCHFLAGS = -D_REENTRANT -DSGI
  CC = cc  -Xcpluscomm
  CXX = CC
  LD = ld
  MAKE = gmake
  INSTALL = cp -f
  SHELL = /bin/bash
  # Using the default /bin/sh on SGI complains about any Makefile
  # "for" loops where arg to "for" is empty
endif

INCLUDES = -I$(CMIXDIR)/H

CFLAGS = $(INCLUDES) $(OPT) $(ARCHFLAGS) $(CMIX_FLAGS)
CXXFLAGS = $(INCLUDES) $(OPT) $(ARCHFLAGS) $(CMIX_FLAGS)

ifeq ($(USE_SNDLIB),TRUE)
  CFLAGS += -DUSE_SNDLIB
  CXXFLAGS += -DUSE_SNDLIB
  SNDLIB = ../sndlib/sndlib.a
else
  SNDLIB =
endif

FLAGS = $(CFLAGS)

# Library flags

ifeq ($(ARCH),LINUX)
  SYSLIBS = -lpthread -lm -ldl
  LDFLAGS = $(SYSLIBS)
  SHARED_LDFLAGS = -shared 
endif
ifeq ($(ARCH),SGI)
  SYSLIBS = -lpthread -laudio -lm
  LDFLAGS = $(SYSLIBS)
  SHARED_LDFLAGS = -shared -update_registry $(LIBDESTDIR)/so_locations
endif

# For benefit of inst makefiles that live outside CMIXDIR hierarchy
UGENS_H = $(CMIXDIR)/H/ugens.h

# for rt insts
INSTRUMENT_H = $(CMIXDIR)/rtstuff/Instrument.h
PROFILE_O = $(CMIXDIR)/rtstuff/profile.o

# for disk-based insts
RTPROFILE_O = $(CMIXDIR)/rtstuff/rtprofile.o

GENLIB = $(LIBDIR)/genlib.a
CMIXOBJS = $(CMIXDIR)/sys/cmix.o $(LIBDIR)/genlib.a

