include ../package.conf

OBJLIBDIR = ../objlib
OBJLIB_A = $(OBJLIBDIR)/objlib.a
OBJLIB_H = $(OBJLIBDIR)/objlib.h

COMMON_OBJS = SPECTACLE_BASE.o fft.o
COMMON_HEADERS = SPECTACLE_BASE.h fft.h
SPECTACLE_OBJS = SPECTACLE.o $(COMMON_OBJS)
TVSPECTACLE_OBJS = TVSPECTACLE.o $(COMMON_OBJS)
CMIXOBJS += $(PROFILE_O)
CXXFLAGS += -I$(OBJLIBDIR)
PROGS = SPECTACLE libSPECTACLE.so TVSPECTACLE libTVSPECTACLE.so

all: libSPECTACLE.so libTVSPECTACLE.so

standalone: SPECTACLE TVSPECTACLE

libSPECTACLE.so: $(SPECTACLE_OBJS) $(GENLIB) $(OBJLIB_A)
	$(CXX) $(SHARED_LDFLAGS) -o $@ $(SPECTACLE_OBJS) $(GENLIB) $(SYSLIBS) \
		$(OBJLIB_A)

SPECTACLE: $(SPECTACLE_OBJS) $(CMIXOBJS) $(OBJLIB_A)
	$(CXX) -o $@ $(SPECTACLE_OBJS) $(CMIXOBJS) $(OBJLIB_A) $(LDFLAGS)

libTVSPECTACLE.so: $(TVSPECTACLE_OBJS) $(GENLIB) $(OBJLIB_A)
	$(CXX) $(SHARED_LDFLAGS) -o $@ $(TVSPECTACLE_OBJS) $(GENLIB) $(SYSLIBS) \
		$(OBJLIB_A)

TVSPECTACLE: $(TVSPECTACLE_OBJS) $(CMIXOBJS) $(OBJLIB_A)
	$(CXX) -o $@ $(TVSPECTACLE_OBJS) $(CMIXOBJS) $(OBJLIB_A) $(LDFLAGS)

$(SPECTACLE_OBJS): $(INSTRUMENT_H) $(OBJLIB_H) $(COMMON_HEADERS) SPECTACLE.h

$(TVSPECTACLE_OBJS): $(INSTRUMENT_H) $(OBJLIB_H) $(COMMON_HEADERS) TVSPECTACLE.h

clean:
	$(RM) $(SPECTACLE_OBJS) $(TVSPECTACLE_OBJS) $(PROGS)
